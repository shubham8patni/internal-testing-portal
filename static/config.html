<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Test - Internal Testing Portal</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <header>
        <h1>Internal Testing Portal</h1>
    </header>

    <div class="container">
        <div class="main-content">
            <h1>Configure Test Execution</h1>
            <p style="margin-bottom: 30px; color: #666;">
                Select categories and provide authentication tokens for testing.
            </p>

            <form id="config-form">
                <div class="form-group">
                    <label for="category-selection">Product Category:</label>
                    <select id="category-selection" name="categories" required>
                        <option value="">-- Select Categories --</option>
                        <option value="all">All Categories</option>
                        <option value="MV4">MV4 - Car</option>
                        <option value="MV2">MV2 - Motorcycle</option>
                        <option value="PET">PET - Pet</option>
                        <option value="PA">PA - Personal Accident</option>
                        <option value="TRAVEL">TRAVEL - Travel</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="admin-token">Admin Portal Auth Token (Optional):</label>
                    <input 
                        type="password" 
                        id="admin-token" 
                        name="admin_auth_token" 
                        placeholder="Enter Admin portal token"
                    >
                    <small style="color: #7f8c8d; display: block; margin-top: 5px;">
                        If not provided, Admin APIs will be skipped
                    </small>
                </div>

                <div class="form-group">
                    <label for="customer-token">Customer Portal Auth Token (Optional):</label>
                    <input 
                        type="password" 
                        id="customer-token" 
                        name="customer_auth_token" 
                        placeholder="Enter Customer portal token"
                    >
                    <small style="color: #7f8c8d; display: block; margin-top: 5px;">
                        If not provided, Customer APIs will be skipped
                    </small>
                </div>

                <button type="submit">Start Execution</button>
            </form>

            <div id="execution-started" style="display: none; margin-top: 20px;">
                <p style="color: #27ae60; font-weight: 600;">
                    ✓ Test execution started!
                </p>
                <p>
                    Redirecting to execution view...
                </p>
            </div>

            <div id="error-message" style="display: none; margin-top: 20px;">
                <p style="color: #e74c3c; font-weight: 600;"></p>
            </div>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                <a href="/index.html" style="color: #3498db; text-decoration: none;">
                    ← Back to Landing Page
                </a>
            </div>
        </div>
    </div>

    <footer>
        <p>Internal Testing Portal v1.0.0 | Powered by FastAPI</p>
    </footer>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session_id');

        if (!sessionId) {
            showError('Session ID not found. Please start from landing page.');
            document.getElementById('config-form').style.display = 'none';
        }

        document.getElementById('config-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const categories = document.getElementById('category-selection').value;
            const adminToken = document.getElementById('admin-token').value.trim() || null;
            const customerToken = document.getElementById('customer-token').value.trim() || null;

            if (!categories) {
                showError('Please select a category');
                return;
            }

            try {
                const response = await fetch('/api/execution/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        session_id: sessionId,
                        categories: categories === 'all' ? [] : [categories],
                        admin_auth_token: adminToken,
                        customer_auth_token: customerToken
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    showSuccess();
                    setTimeout(() => {
                        window.location.href = `/execution.html?session_id=${sessionId}`;
                    }, 1500);
                } else {
                    const error = await response.json();
                    showError(error.detail || 'Failed to start execution');
                }
            } catch (error) {
                showError('Error starting execution. Please try again.');
                console.error('Error:', error);
            }
        });

        function showSuccess() {
            document.getElementById('config-form').style.display = 'none';
            document.getElementById('execution-started').style.display = 'block';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.querySelector('p').textContent = message;
            errorDiv.style.display = 'block';
        }
    </script>
</body>
</html>
